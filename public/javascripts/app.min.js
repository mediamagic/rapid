angular.module("rapid",["ngResource","ngCookies","ui"]).config(["$routeProvider","$locationProvider",function(a){a.when("/main",{templateUrl:"/views/Main.html",controller:MainCtrl,name:"Main"}).when("/login",{templateUrl:"/views/Login.html",controller:LoginCtrl,name:"Login"}).otherwise({redirectTo:"/main"})}]).directive("uiIsotope",function(){return{priority:0,restrict:"A",link:function(a,b,c){var d=JSON.parse(c.options);d.getSortData={};for(var e in a.settings.categories)c=a.settings.categories[e],
d.getSortData[c]=createOrderFn(c);setTimeout(function(){b.isotope(d).isotope("reloadItems").isotope({sortBy:"all"})},100);a.$watch("articles",function(a,c){a!=c&&b.isotope("reloadItems")});a.$watch("filters.category",function(a){b.isotope({sortBy:a})})}}}).directive("isoItem",["$compile",function(a){return{priority:100,restrict:"A",link:function(b,c){var d=b.$index,e=b.articles[d],f=c.children(".preview");e.index=d;d=createPreview(f,e);a(d.contents())(b)}}}]).directive("isoGallery",function(){return{priority:0,
restrict:"A",link:function(a,b){setTimeout(function(){var a=JSON.parse(b.attr("iso-gallery"));b.slidesjs({width:parseInt(a.width),height:parseInt(a.height),navigation:{active:!1},play:{auto:!0,restartDelay:1E3}})},100)}}});function createOrderFn(a){return function(b){b=$(b).attr("rel");b=JSON.parse(b);return parseInt(b[a])}}
function createPreview(a,b){var c="",c=b.preview.size.split("x"),d={width:220*c[0]+20*(c[0]-1),height:220*c[1]+20*(c[1]-1)},e="none"!=b.preview.link?createContent(b):"";switch(b.preview.type){case "flash":c=$("<div></div>");c.flash({swf:"/images/swfs/"+b.preview.content,width:d.width,height:d.height,wmode:"transparent",allowFullScreen:!1});break;case "iframe":c=$("<iframe></iframe>");c.attr({scrolling:"no",frameborder:0,width:d.width,height:d.height,src:b.preview.content});break;case "image":var c=
$("<div></div>"),f=b.preview.content;1<f.length&&c.attr("iso-gallery",JSON.stringify(d));for(d=0;d<f.length;d++)$("<img />").attr("src","/images/imgs/"+f[d]).appendTo(c);break;default:c=b.preview.content}a.html(c).css("background",b.preview.bgColor).siblings(".bind").bind("click",function(){$(".close").click();a.hide().parent().removeClass("preview").addClass("content").append(e.show()).parent().isotope("reLayout",function(){$("html, body").animate({scrollTop:$("#item_"+b.index).offset().top-190})});
$(".article.preview").addClass("masked")}).parent().addClass("preview");return a}
function createContent(a){var b=$('<div class="content"><div class="close">x \u05e1\u05d2\u05d5\u05e8</div></div>'),c=a.content,d="";switch(c.type){case "flash":break;case "iframe":break;case "image":break;default:d=c.content}b.append(d).css("background",a.content.bgColor).show().children(".close").bind("click",function(){b.hide().siblings(".preview").show();b.parent().addClass("preview").removeClass("content").parent().isotope("reLayout",function(){});$(".article.masked").removeClass("masked")});
return b};angular.module("rapid.controllers",["ngResource","ngCookies","ui"]);
var GlobalCtrl=["$scope","$resource","$location","$window","$routeParams","$cookies","$route",function(a,b,c,d,e,f){a.Settings=b("/resources/settings");a.location=c;a.resource=b;a.route=e;a.Math=d.Math;a.stats=function(b,c){a.Stats.save({type:b},{ref:c},function(){})};a.Settings.get({},function(b){a.settings=b;a.Stats=a.resource("/resources/stats/:type",{_csrf:f["csrf.token"]});a.Login=a.resource("/api/login",{_csrf:f["csrf.token"]})});a.filters={category:"all"}}],MainCtrl=["$scope",function(a){a.Articles=
a.resource("/resources/articles/:id");a.contentLoaded=!1;a.getCategory=function(b){b=a.articles[b];var c=[],d=a.filters.category;c.push("size"+b.preview.size);c.push(b.categories[d]>a.articles.length?"disabled":"enabled");c.push("none"==b.preview.link.type?"unlinked":"linked");return c};a.Articles.query({},function(b){var c=a.settings.categories,d=b.length+1,e;for(e in b)for(var f=b[e],g=0;g<c.length;g++){var h=c[g];void 0==f.categories[h]&&(f.categories[h]=d,d++)}a.articles=b;a.contentLoaded=!0})}],
LoginCtrl=["$scope","$window",function(a,b){var c=a.location.$$search.url;a.loginSubmit=function(){a.Login.save({},{username:a.username,password:a.password},function(d){void 0===d.error&&(void 0===c?a.location.path("/admin"):b.location.href=c)})}}];

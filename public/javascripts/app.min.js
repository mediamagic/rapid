var staticForm=createForm();
angular.module("rapid",["ngResource","ngCookies","ui"]).config(["$routeProvider","$locationProvider",function(a){a.when("/main",{templateUrl:"/views/Main.html",controller:MainCtrl,name:"Main"}).when("/login",{templateUrl:"/views/Login.html",controller:LoginCtrl,name:"Login"}).otherwise({redirectTo:"/main"})}]).directive("uiIsotope",function(){return{priority:0,restrict:"A",link:function(a,b,d){var c=JSON.parse(d.options);c.getSortData={};for(var e in a.settings.categories)d=e,c.getSortData[d]=createOrderFn(d);
setTimeout(function(){b.isotope(c).isotope("reloadItems").isotope({sortBy:"all"})},100);a.$watch("articles",function(a,d){a!=d&&b.isotope("reloadItems")});a.$watch("filters.category",function(a){b.isotope({sortBy:a})})}}}).directive("isoItem",["$compile",function(a){return{priority:100,restrict:"A",link:function(b,d){var c=b.$index,e=b.articles[c],f=d.children(".preview");e.index=c;e.form=staticForm;c=createPreview(f,e);a(c.contents())(b)}}}]).directive("isoGallery",function(){return{priority:0,restrict:"A",
link:function(a,b){setTimeout(function(){var a=JSON.parse(b.attr("iso-gallery"));b.slidesjs({width:parseInt(a.width),height:parseInt(a.height),navigation:{active:!1},play:{auto:!0,restartDelay:1E3}})},100)}}}).directive("totop",function(){return{priority:0,restrict:"C",link:function(a,b){b.bind("click",function(){$("html, body").animate({scrollTop:0})});$(window).scroll(function(){var a=$(b).parent(),c=$(window),e=$(document),f=a.width()-$(b).width()+a.offset().left-9,a=c.scrollTop(),c=c.height(),
e=e.height(),g=$("#footer").height(),h=e-(a+c),f={position:"fixed",bottom:20+g,left:f};f.bottom=c+a+20==e?20+g:h-20<g?20+g+h:0;$(b).css(f)})}}});function createOrderFn(a){return function(b){b=$(b).attr("rel");b=JSON.parse(b);return parseInt(b[a])}}
function createPreview(a,b){var d="",d=b.preview.size.split("x"),d={width:220*d[0]+20*(d[0]-1),height:220*d[1]+20*(d[1]-1)},c="none"!=b.preview.link.type?createContent(b):"",d=parseContent(b,d,"preview");a.html(d).css("background",b.preview.bgColor).siblings(".bind").bind("click",function(){"inner"==b.preview.link.type?($(".close").click(),a.hide().parent().removeClass("preview").addClass("content").append(c.show().append(b.form)).parent().isotope("reLayout",function(){var a={scrollTop:$("#item_"+
b.index).offset().top-190};$("html, body").animate(a)}),$(".article.preview").addClass("masked")):window.open(b.preview.link.url,"_blank").focus()}).parent().addClass("preview");return a}
function createContent(a){var b=$('<div class="content"></div>'),d="",d=createSidebar(a.sidebar),c=$("<div></div>"),e=$("<div></div>");c.addClass("close").html("x \u05e1\u05d2\u05d5\u05e8");b.append(c).append(d).append(e);d=parseContent(a,null,"content");e.append(d);b.css("background",a.content.bgColor).show().children(".close").bind("click",function(){b.hide().siblings(".preview").show();b.parent().addClass("preview").removeClass("content").parent().isotope("reLayout",function(){});$(".article.masked").removeClass("masked")});
return b}function createSidebar(a){var b=$("<div></div>"),d=$("<div></div>"),c=$("<div></div>"),e=$("<a></a>");d.addClass("title").html(a.title).appendTo(b);c.addClass("content").html(a.description).appendTo(b);d={href:a.readMore.url,target:"_blank"};e.addClass("link").html(a.readMore.title).attr(d).appendTo(b);return b}
function createForm(){var a=$("<div></div>"),b=$("<form></form>"),d=$("<input />"),c={firstname:{type:"text",placeholder:"first name",required:"",name:"firstname"},lastname:{type:"text",placeholder:"last name",required:"",name:"lastname"},phone:{type:"phone",placeholder:"phone",required:"",name:"phone"},email:{type:"email",placeholder:"email",required:"",name:"email"},priv:{type:"radio",placeholder:"first name",name:"type",value:"private",label:"other label",id:"form_private"},business:{type:"radio",
placeholder:"first name",name:"type",value:"business",label:"some label",id:"form_business"},submit:{type:"submit",value:"submit"}},e;for(e in c)d.clone().attr(c[e]).appendTo(b).after(function(){if("radio"==c[e].type){var a=$("<label></label>");a.attr("for",c[e].id);a.html(c[e].label);a.append('<div class="icon"></div>');return a}});b.appendTo(a);a.addClass("form");return a}
function parseContent(a,b,d){var c="",c=a[d].content;"content"===d&&(b={width:480,height:500});switch(a[d].type){case "flash":a=$("<div></div>");a.flash({swf:"/images/swfs/"+c,width:b.width,height:b.height,wmode:"transparent",allowFullScreen:!1});c=a;break;case "iframe":a=$("<iframe></iframe>");a.attr({scrolling:"no",frameborder:0,width:b.width,height:b.height,src:c});c=a;break;case "image":a=$("<div></div>");1<c.length&&a.attr("iso-gallery",JSON.stringify(b));for(b=0;b<c.length;b++)$("<img />").attr("src",
"/images/imgs/"+c[b].hashName).appendTo(a);c=a;break}return c};angular.module("rapid.controllers",["ngResource","ngCookies","ui"]);
var GlobalCtrl=["$scope","$resource","$location","$window","$routeParams","$cookies","$route",function(a,b,d,c,e,f){a.Settings=b("/resources/settings");a.location=d;a.resource=b;a.route=e;a.Math=c.Math;a.stats=function(b,c){a.Stats.save({type:b},{ref:c},function(){})};a.Settings.get({},function(b){a.settings=b;a.Stats=a.resource("/resources/stats/:type",{_csrf:f["csrf.token"]});a.Login=a.resource("/api/login",{_csrf:f["csrf.token"]})});a.filters={category:"all"}}],MainCtrl=["$scope",function(a){a.Articles=
a.resource("/resources/articles/:id");a.contentLoaded=!1;a.getCategory=function(b){b=a.articles[b];var d=[],c=a.filters.category;d.push("size"+b.preview.size);d.push(b.categories[c]>a.articles.length?"disabled":"enabled");d.push("none"==b.preview.link.type?"unlinked":"linked");return d};a.Articles.query({},function(b){var d=a.settings.categories,c=b.length+1,e;for(e in b){var f=b[e],g;for(g in d)void 0==f.categories[g]&&(f.categories[g]=c,c++)}a.articles=b;a.contentLoaded=!0})}],LoginCtrl=["$scope",
"$window",function(a,b){var d=a.location.$$search.url;a.loginSubmit=function(){a.Login.save({},{username:a.username,password:a.password},function(c){void 0===c.error&&(void 0===d?a.location.path("/admin"):b.location.href=d)})}}];

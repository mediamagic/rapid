angular.module("rapid",["ngResource","ngCookies","ui"]).config(["$routeProvider","$locationProvider",function(a){a.when("/main",{templateUrl:"/views/Main.html",controller:MainCtrl,name:"Main"}).when("/login",{templateUrl:"/views/Login.html",controller:LoginCtrl,name:"Login"}).otherwise({redirectTo:"/main"})}]).directive("uiIsotope",function(){return{priority:0,restrict:"A",link:function(a,b,c){var d=JSON.parse(c.options);d.getSortData={};for(var e in a.settings.categories)c=a.settings.categories[e],
d.getSortData[c]=createOrderFn(c);setTimeout(function(){b.isotope(d).isotope("reloadItems").isotope({sortBy:"all"})},100);a.$watch("articles",function(a,c){a!=c&&b.isotope("reloadItems")});a.$watch("filters.category",function(a){b.isotope({sortBy:a})})}}}).directive("isoItem",function(){return{priority:0,restrict:"A",link:function(a,b){var c=a.articles[a.$index],d=b.children(".preview");console.log(c);createPreview(d,c)}}});
function createOrderFn(a){return function(b){b=$(b).attr("rel");b=JSON.parse(b);return parseInt(b[a])}}function createPreview(a,b){var c=createContent(b),d="";switch(b.preview.type){case "flash":break;case "iframe":break;case "image":break;default:d=b.preview.content}a.html(d).css("background",b.preview.bgColor).bind("click",function(){$(".close").click();a.hide().parent().append(c.show()).parent().isotope("reLayout")})}
function createContent(a){var b=$('<div class="content"><div class="close">x \u05e1\u05d2\u05d5\u05e8</div></div>'),c=a.content,d="";switch(c.type){case "flash":break;case "iframe":break;case "image":break;default:d=c.content}b.append(d).css("background",a.content.bgColor).show().children(".close").bind("click",function(){b.hide().siblings(".preview").show();b.parent().parent().isotope("reLayout")}).parent().scrollTop();return b};angular.module("rapid.controllers",["ngResource","ngCookies","ui"]);
var GlobalCtrl=["$scope","$resource","$location","$window","$routeParams","$cookies","$route",function(a,b,c,d,e,f){a.Settings=b("/resources/settings");a.location=c;a.resource=b;a.route=e;a.Math=d.Math;a.stats=function(b,c){a.Stats.save({type:b},{ref:c},function(){})};a.Settings.get({},function(b){a.settings=b;a.Stats=a.resource("/resources/stats/:type",{_csrf:f["csrf.token"]});a.Login=a.resource("/api/login",{_csrf:f["csrf.token"]})});a.filters={category:"all"}}],MainCtrl=["$scope",function(a){a.Articles=
a.resource("/resources/articles/:id");a.contentLoaded=!1;a.getCategory=function(b){b=a.articles[b];var c=[],d=a.filters.category;c.push("size"+b.preview.size);b.categories[d]>a.articles.length&&c.push("disabled");"none"==b.preview.link.type?c.push("unlinked"):c.push("linked");return c};a.Articles.query({},function(b){var c=a.settings.categories,d=b.length+1,e;for(e in b)for(var f=b[e],g=0;g<c.length;g++){var h=c[g];void 0==f.categories[h]&&(f.categories[h]=d,d++)}a.articles=b;a.contentLoaded=!0})}],
LoginCtrl=["$scope","$window",function(a,b){var c=a.location.$$search.url;a.loginSubmit=function(){a.Login.save({},{username:a.username,password:a.password},function(d){void 0===d.error&&(void 0===c?a.location.path("/admin"):b.location.href=c)})}}];

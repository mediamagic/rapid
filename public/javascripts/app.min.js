var staticForm="";
angular.module("rapid",["ngResource","ngCookies","ui"]).config(["$routeProvider","$locationProvider",function(a){a.when("/main",{templateUrl:"/views/Main.html",controller:MainCtrl,name:"Main"}).when("/login",{templateUrl:"/views/Login.html",controller:LoginCtrl,name:"Login"}).otherwise({redirectTo:"/main"})}]).directive("uiIsotope",["$compile",function(a){return{priority:0,restrict:"A",link:function(b,c,d){var e=JSON.parse(d.options);staticForm=$(".form").clone();e.getSortData={};for(var f in b.settings.categories)d=
f,e.getSortData[d]=createOrderFn(d);setTimeout(function(){c.isotope(e).isotope("reloadItems").isotope({sortBy:"all"})},100);b.$watch("articles",function(a,b){a!=b&&c.isotope("reloadItems")});b.$watch("filters.category",function(a){c.isotope({sortBy:a})});a(staticForm)(b)}}}]).directive("isoItem",["$compile",function(a){return{priority:100,restrict:"A",link:function(b,c){var d=b.$index,e=b.articles[d],f=c.children(".preview");e.index=d;e.form=staticForm;e.compile=a;e.scope=b;d=createPreview(f,e);("flash"==
e.preview.type||"flash"==e.content.type)&&c.addClass("hidden-phone hidden-tablet");a(d.contents())(b)}}}]).directive("isoGallery",function(){return{priority:0,restrict:"A",link:function(a,b){setTimeout(function(){JSON.parse(b.attr("iso-gallery"));b.slidesjs({navigation:{active:!1},play:{auto:!0,restartDelay:1E3}})},100)}}}).directive("totop",function(){return{priority:0,restrict:"C",link:function(a,b){b.bind("click",function(){$("html, body").animate({scrollTop:0})});$(window).scroll(function(){var a=
$(b).parent(),d=$(window),e=$(document),f=a.width()-$(b).width()+a.offset().left-9,a=d.scrollTop(),d=d.height(),e=e.height(),g=$("#footer").height(),h=e-(a+d),f={position:"fixed",bottom:20+g,left:f};f.bottom=d+a+20==e?20+g:h-20<g?20+g+h:0;$(b).css(f)})}}});function createOrderFn(a){return function(b){b=$(b).attr("rel");b=JSON.parse(b);return parseInt(b[a])}}
function createPreview(a,b){var c="",c=b.preview.size.split("x"),c=parseContent(b,{width:220*c[0]+20*(c[0]-1),height:220*c[1]+20*(c[1]-1)},"preview");a.html(c).css("background",b.preview.bgColor).parent().addClass("preview");"inner"==b.preview.link.type?a.siblings(".bind").bind("click",function(){$(".close").click();var c="none"!=b.preview.link.type?createContent(b):"";a.hide().parent().removeClass("preview").addClass("content").append(c.append(b.form)).show().parent().isotope("reLayout",function(){var a=
{scrollTop:$("#item_"+b.index).offset().top-190};$("html, body").animate(a)});$(".article.preview").addClass("masked")}):a.siblings(".bind").bind("click",function(){window.open(b.preview.link.url,"_blank").focus()});return a}
function createContent(a){var b=$('<div class="content"></div>'),c="",c=createSidebar(a.sidebar),d=$("<div></div>"),e=$("<div></div>");d.addClass("close").html("x \u05e1\u05d2\u05d5\u05e8");b.append(d).append(c).append(e);c=parseContent(a,null,"content");e.addClass("inner");e.append(c);b.css("background",a.content.bgColor).show(500).children(".close").bind("click",function(){b.hide(500,function(){$(this).html("").siblings(".preview").show().parent().addClass("preview").removeClass("content").parent().isotope("reLayout",
function(){});$(".article.masked").removeClass("masked")})});return b}function createSidebar(a){var b=$("<div></div>"),c=$("<div></div>"),d=$("<div></div>"),e=$("<pre></pre>"),f=$("<a></a>");b.addClass("sidebar");c.addClass("divider").appendTo(b);d.addClass("title").html(a.title).appendTo(b);e.addClass("description").html(a.description).appendTo(b);c={href:a.readMore.url,target:"_blank"};f.addClass("link").html(a.readMore.title).attr(c).appendTo(b);return b}
function parseContent(a,b,c){var d="",d=a[c].content;"content"===c&&(b={width:"100%",height:"100%"});switch(a[c].type){case "flash":c=$('<div class="flash"></div>');c.flash({swf:"/images/swfs/"+d,width:b.width,height:b.height,wmode:"transparent",allowFullScreen:!1});d=c;break;case "iframe":c=$('<iframe class="iframe"></iframe>');a={scrolling:"no",frameborder:0,width:b.width,height:b.height,src:d};c.attr(a);d=c;break;case "image":c=$('<div class="image"></div>');1<d.length&&(console.log("more than one!"),
c.attr("iso-gallery",JSON.stringify(b)));for(b=0;b<d.length;b++)$("<img />").attr("src","/images/imgs/"+d[b].hashName).appendTo(c);d=a.compile(c)(a.scope);break;case "video":c=$('<iframe class="video"></iframe>');a={scrolling:"no",frameborder:0,src:"//www.youtube.com/embed/"+d+"?feature=oembed&autoplay=1&rel=0&wmode=transparent"};c.attr(a);d=c;break;default:b=$("<html />");var e=$("<link  />").attr({type:"text/css",rel:"stylesheet",href:window.document.location.protocol+"//"+window.document.location.host+
"/stylesheets/tinyFonts.css"}),f=$("<head />"),g=$("<body />").attr("dir","rtl");e.appendTo(f);g.append(d);b.append(f).append(g);d=$("<iframe />").attr({frameborder:0,style:"padding:0;border:none",scrolling:"no",src:"data:text/html;charset=utf-8,"+b.html()}).attr("class",a[c].size||"text")}return d};angular.module("rapid.controllers",["ngResource","ngCookies","ui"]);
var GlobalCtrl=["$scope","$resource","$location","$window","$cookies","$http",function(a,b,c,d,e,f){a.Settings=b("/resources/settings");a.location=c;a.resource=b;a.Settings.get({},function(b){a.settings=b;a.Login=a.resource("/api/login",{_csrf:e["csrf.token"]});a.$broadcast("settings_loaded")});a.filters={category:"all"};a.form={firstname:"",lastname:"",phone:"",email:"",type:"private"};a.formReset=angular.copy(a.form);a.formSubmit=function(){console.log(a.form);f.post("/someUrl",a.form).success(function(){a.form=
angular.copy(a.formReset);return!1}).error(function(){return!1})};a.showForm=!1;a.toggleForm=function(){a.showForm=!a.showForm}}],MainCtrl=["$scope",function(a){a.Articles=a.resource("/resources/articles/:id");a.contentLoaded=!1;a.$on("settings_loaded",function(){console.log("herer");a.getCategory=function(b){b=a.articles[b];var c=[],d=a.filters.category;c.push("size"+b.preview.size);c.push(b.categories[d]>a.articles.length?"disabled":"enabled");c.push("none"==b.preview.link.type?"unlinked":"linked");
return c};a.Articles.query({},function(b){var c=a.settings.categories,d=b.length+1,e;for(e in b){var f=b[e],g;for(g in c)void 0==f.categories[g]&&(f.categories[g]=d,d++)}a.articles=b;a.contentLoaded=!0})});a.settings&&a.$emit("settings_loaded")}],LoginCtrl=["$scope","$window",function(a,b){a.loginSubmit=function(){a.Login.save({},{username:a.username,password:a.password},function(a){0===a.error&&(b.location.href="/admin")})}}];
